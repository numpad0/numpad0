# クラッシュコースNostr
## 2023/02/06

## Nostrってなに
新しいTwitterクローンアプリ。仮想通貨機能(Lightning Networkによる簡易送金)が初めから統合されている。アーキテクチャはWinny掲示板に似ているらしい。筆者は使ったことがないので知らん。投稿は秘密鍵で署名され、 **リレーサーバ** に送信される。クライアントは推しがいる **リレーサーバ** に接続してフォローしておくと、投稿が降ってくる。手動更新ではなくストリーミングAPI的な挙動になる。

## はじめかた
クライアントアプリ(iOS: Damus, Android: Amethyst)を落として希望の@ユーザ名を打ち込むと秒でIDができる。ローカルの生成動作なので何の待ちもチェックもない。この時 **公開鍵** と **秘密鍵** が生成される。これが **ID** と **パスワード** に相当する。秘密鍵は絶対になくしてはいけない。@ユーザ名とディスプレイネームはアイデンティティではなくプロフィール情報の扱いになる。

## 秘密鍵の取り扱い
**秘密鍵は絶対になくしてはいけない** 。なくすとログインできなくなる。また、パスワードなので他人に教えてはいけないし、信頼できないアプリに打ち込んでもいけない。秘密鍵を流出、または紛失した場合、**変更や再発行や失効や継承はできない** 。ただし、認証バッジを剥がして付け替えることができる。筆者はスクショ撮っとくのがいいと考えている。

## フォロワーへのID共有方法
@ユーザ名を教えても意味はあんまりない。検索する必要があり出てくる保証はない。クライアントアプリのプロフィール画面に公開鍵が出ているし、QRコード表示機能もある。その文字列をコピペするか、スクショを共有するか、QRをカメラで撮らせるのが早い。なお既に公開鍵の形式が2種類あり、場合により受け入れ側アプリに合わせた変換が必要になっている(草)。

## 実使用、フォロー、投稿、画像投稿、ログ
- Twitter風に言うと、ツイート、フォロー、ふぁぼ、RT、ID検索は実装されている。ハッシュタグ、リストは実装されていない。画像投稿はtwitpic形式、引用RTはクライアント実装で実現されている。

- 投稿するには、ただ投稿すればクライアントアプリが登録しているリレーサーバに一斉送信する。フォローするには、対象の公開鍵(ID)が観測されたことがあるリレーサーバに接続している必要がある。その状態でフォローするとリレーサーバがその事実を認識して投稿を送ってくる。リレーサーバ間のフェデレーションとか連携機能は、まだない。また、フォロー中のアカウントが他のリレーサーバに送っていた投稿は見えない。今後の展開としては、サーバをクラスタ化するとか、メンバーシップ限定リレーサーバを作って有料会員限定で見せるとか、仮想通貨で決済したユーザにのみ見せるいったことも考えられる。

- 過去ログは、リレーサーバが送ってくる限りは見える。リレーサーバにはデータに関して何の義理もないので全てを保持している保証はなんもないが、単発の投稿とか過去ログの束がネット上で見つかれば、その真正性は公開鍵で担保される。あるいは自鯖リレーにクライアントを登録して同報しておけば取れる。

## 認証バッジ
認証バッジ機能がある。ただし、中央集権な運営はないので、認証は外部に丸投げになっている。具体的にはプロフで指定されている適当なサイトに`.well-known/nostr.json?id=<id>`という形式でクエリを打って公開鍵が確認できればクライアント側でバッジが付く。適当なサイトが適当かはユーザが判断する。つまり明らかななりすまし垢に`hxxp://dasuihvg58wj89svrj923v.example`みたいなあからさまなスパムサイトがバッジを出していても通ってしまう。筆者は@ユーザ名と同名のドメインを持っているのでそこで付けている。

