# クラッシュコースNostr
## 2023/02/07

## Nostrってなに
新しいTwitterクローン(2).web3。仮想通貨機能(Lightning Networkによる簡易送金)が初めから統合されている。ブロックチェーンではない。アーキテクチャはWinny掲示板に似ているらしい。IDは独自形式の公開鍵ペアで、投稿は秘密鍵で署名され、 **リレーサーバ** に送信される。ユーザは推しがいる **リレーサーバ** に接続してフォローしておくと、投稿が降ってくる。手動更新ではなくストリーミングAPI的な挙動になる。

## 投稿の呼び方
"note"。頭は大文字なのか? わからない。

## はじめかた
クライアントアプリ(iOS: Damus, Android: Amethyst, PC: https://iris.to)を開いて希望の@ユーザ名を打ち込むと秒でIDができる。ローカルの生成動作なので何の待ちもチェックもない。この時 **公開鍵** と **秘密鍵** が生成される。これが **ID** と **パスワード** に相当する。秘密鍵は絶対になくしてはいけない。@ユーザ名とディスプレイネームはアイデンティティではなくプロフィール情報の扱いなので任意に設定できる。

## 秘密鍵の取り扱い
**秘密鍵は絶対になくしてはいけない** 。なくすとログインできなくなる。また、パスワードなので他人に教えてはいけないし、信頼できないアプリに打ち込んでもいけない。秘密鍵を流出、または紛失した場合、**変更や再発行や失効や継承はできない** ので、転生することになる。ただし、認証バッジを剥がして付け替えることはできる。なくさないように鍵はスクショ撮っとくのがいいと筆者は考えている。

## ログイン
秘密鍵を打ち込むとログインできる。べきところに公開鍵を打ち込むとネトストできる(?)。Twitter古参の言い方で言えばxAuthかつパスワード変更不可なので **秘密鍵は絶対になくしてはいけない** 。iris.toには入力していいのか? 何も分からない。筆者は雰囲気でNostrをやっている。

## リレーサーバとは
noteを受け付けて保持してくれるお人好しが運営している掲示板サーバ。クライアントアプリから投稿すると一斉に登録全リレーへ同報され、逆に待っているとフォローしている公開鍵の付いたnoteが降ってくる。メンションは同じリレーサーバを共有している相手同士でしか見えない。

## フォロワーへのID共有方法
クライアントアプリのプロフィール画面に公開鍵が見えているので、それをスクショするのが早い。またはQRコードが出せるのでそれを見せてもよい。

## 実使用、フォロー、投稿、画像投稿、ログ
- Twitter風に言うと、ツイート、フォロー、ふぁぼ、RT、ID検索、ハッシュタグは実装されている。日本語ハッシュタグとリスト機能は実装されていない。画像投稿は末尾が拡張子のURLを貼るとプレビューが出るが投稿機能はまだない。引用RTはクライアント実装による。
- 過去ログは、リレーサーバが送ってくる限りは見える。リレーサーバから消えると消えるが、過去ログの真正性は公開鍵で担保される。自鯖リレーを投稿先に含めておけば自前でも取れる。
- 削除はできない。あんふぁぼもできない(なぜ?)。

## 認証バッジ/NIP-05
プロフィール画面で指定しているサーバに`/.well-known/nostr.json?id=<id>`という形式でクエリを打って、NIP-05指定の形式で打ったIDと公開鍵が返ってくればクライアント側でバッジが付く。`github.com/username.key`に近い。
